window.DecodeStream=function(){function b(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return b.prototype={ensureBuffer:function(u){var v=this.buffer,m=v?v.byteLength:0;if(u<m)return v;for(var f=512;f<u;)f<<=1;for(var y=new Uint8Array(f),h=0;h<m;++h)y[h]=v[h];return this.buffer=y},getByte:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(u){var v=this.pos;if(u){this.ensureBuffer(v+u);for(var m=v+u;!this.eof&&this.bufferLength<m;)this.readBlock();var f=this.bufferLength;m>f&&(m=f)}else{for(;!this.eof;)this.readBlock();var m=this.bufferLength}return this.pos=m,this.buffer.subarray(v,m)},lookChar:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var u=this.pos;this.bufferLength<=u;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(u,v,m){for(var f=u+v;this.bufferLength<=f&&!this.eof;)this.readBlock();return new Stream(this.buffer,u,v,m)},skip:function(u){u||(u=1),this.pos+=u},reset:function(){this.pos=0}},b}();window.FlateStream=function(){var b=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),u=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),v=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],m=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function f(h){throw new Error(h)}function y(h){var x=0,r=h[x++],e=h[x++];(r==-1||e==-1)&&f("Invalid header in flate stream"),(r&15)!=8&&f("Unknown compression method in flate stream"),((r<<8)+e)%31!=0&&f("Bad FCHECK in flate stream"),e&32&&f("FDICT bit set in flate stream"),this.bytes=h,this.bytesPos=x,this.codeSize=0,this.codeBuf=0,DecodeStream.call(this)}return y.prototype=Object.create(DecodeStream.prototype),y.prototype.getBits=function(h){for(var x=this.codeSize,r=this.codeBuf,e=this.bytes,t=this.bytesPos,a;x<h;)typeof(a=e[t++])>"u"&&f("Bad encoding in flate stream"),r|=a<<x,x+=8;return a=r&(1<<h)-1,this.codeBuf=r>>h,this.codeSize=x-=h,this.bytesPos=t,a},y.prototype.getCode=function(h){for(var x=h[0],r=h[1],e=this.codeSize,t=this.codeBuf,a=this.bytes,o=this.bytesPos;e<r;){var s;typeof(s=a[o++])>"u"&&f("Bad encoding in flate stream"),t|=s<<e,e+=8}var i=x[t&(1<<r)-1],c=i>>16,l=i&65535;return(e==0||e<c||c==0)&&f("Bad encoding in flate stream"),this.codeBuf=t>>c,this.codeSize=e-c,this.bytesPos=o,l},y.prototype.generateHuffmanTable=function(h){for(var x=h.length,r=0,e=0;e<x;++e)h[e]>r&&(r=h[e]);for(var t=1<<r,a=new Uint32Array(t),o=1,s=0,i=2;o<=r;++o,s<<=1,i<<=1)for(var c=0;c<x;++c)if(h[c]==o){for(var l=0,d=s,e=0;e<o;++e)l=l<<1|d&1,d>>=1;for(var e=l;e<t;e+=i)a[e]=o<<16|c;++s}return[a,r]},y.prototype.readBlock=function(){function h(E,M,F,N,G){for(var H=E.getBits(F)+N;H-- >0;)M[B++]=G}var x=this.getBits(3);if(x&1&&(this.eof=!0),x>>=1,x==0){var r=this.bytes,e=this.bytesPos,t;typeof(t=r[e++])>"u"&&f("Bad block header in flate stream");var a=t;typeof(t=r[e++])>"u"&&f("Bad block header in flate stream"),a|=t<<8,typeof(t=r[e++])>"u"&&f("Bad block header in flate stream");var o=t;typeof(t=r[e++])>"u"&&f("Bad block header in flate stream"),o|=t<<8,o!=(~a&65535)&&f("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var s=this.bufferLength,n=this.ensureBuffer(s+a),i=s+a;this.bufferLength=i;for(var c=s;c<i;++c){if(typeof(t=r[e++])>"u"){this.eof=!0;break}n[c]=t}this.bytesPos=e;return}var l,d;if(x==1)l=v,d=m;else if(x==2){for(var g=this.getBits(5)+257,T=this.getBits(5)+1,R=this.getBits(4)+4,z=Array(b.length),B=0;B<R;)z[b[B++]]=this.getBits(3);for(var U=this.generateHuffmanTable(z),p=0,B=0,P=g+T,k=new Array(P);B<P;){var C=this.getCode(U);C==16?h(this,k,2,3,p):C==17?h(this,k,3,3,p=0):C==18?h(this,k,7,11,p=0):k[B++]=p=C}l=this.generateHuffmanTable(k.slice(0,g)),d=this.generateHuffmanTable(k.slice(g,P))}else f("Unknown block type in flate stream");for(var n=this.buffer,D=n?n.length:0,w=this.bufferLength;;){var I=this.getCode(l);if(I<256){w+1>=D&&(n=this.ensureBuffer(w+1),D=n.length),n[w++]=I;continue}if(I==256){this.bufferLength=w;return}I-=257,I=S[I];var A=I>>16;A>0&&(A=this.getBits(A));var p=(I&65535)+A;I=this.getCode(d),I=u[I],A=I>>16,A>0&&(A=this.getBits(A));var O=(I&65535)+A;w+p>=D&&(n=this.ensureBuffer(w+p),D=n.length);for(var _=0;_<p;++_,++w)n[w]=n[w-O]}},y}();window.PNG=function(){let b=1,S=2,u=0,v=document.createElement("canvas"),m=v.getContext("2d"),f=function(h){m.width=h.width,m.height=h.height,m.clearRect(0,0,h.width,h.height),m.putImageData(h,0,0);const x=new Image;return x.src=v.toDataURL(),x};class y{static load(x,r,e){typeof r=="function"&&(e=r);const t=new XMLHttpRequest;return t.open("GET",x,!0),t.responseType="arraybuffer",t.onload=()=>{const a=new Uint8Array(t.response||t.mozResponseArrayBuffer),o=new y(a);return typeof(r&&r.getContext)=="function"&&o.render(r),typeof e=="function"?e(o):void 0},t.send(null)}constructor(x){let r;this.data=x,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={};let e=null;for(;;){var t;let g=this.readUInt32(),T="";for(r=0;r<4;r++)T+=String.fromCharCode(this.data[this.pos++]);switch(T){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(g);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var a=this.readUInt16(),o=this.readUInt16()||100;e.delay=1e3*a/o,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for(T==="fdAT"&&(this.pos+=4,g-=4),t=e&&e.data||this.imgData,r=0;r<g;r++)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(g);var s=255-this.transparency.indexed.length;if(s>0)for(r=0;r<s;r++)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(g)[0];break;case 2:this.transparency.rgb=this.read(g);break}break;case"tEXt":var i=this.read(g),c=i.indexOf(0),l=String.fromCharCode.apply(String,i.slice(0,c));this.text[l]=String.fromCharCode.apply(String,i.slice(c+1));break;case"IEND":switch(e&&this.animation.frames.push(e),this.colorType){case 0:case 3:case 4:this.colors=1;break;case 2:case 6:this.colors=3;break}this.hasAlphaChannel=[4,6].includes(this.colorType);var d=this.colors+(this.hasAlphaChannel?1:0);switch(this.pixelBitlength=this.bits*d,this.colors){case 1:this.colorSpace="DeviceGray";break;case 3:this.colorSpace="DeviceRGB";break}this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=g}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}read(x){const r=new Array(x);for(let e=0;e<x;e++)r[e]=this.data[this.pos++];return r}readUInt32(){const x=this.data[this.pos++]<<24,r=this.data[this.pos++]<<16,e=this.data[this.pos++]<<8,t=this.data[this.pos++];return x|r|e|t}readUInt16(){const x=this.data[this.pos++]<<8,r=this.data[this.pos++];return x|r}decodePixels(x){if(x==null&&(x=this.imgData),x.length===0)return new Uint8Array(0);x=new FlateStream(x),x=x.getBytes();const{width:r,height:e}=this,t=this.pixelBitlength/8,a=new Uint8Array(r*e*t),{length:o}=x;let s=0;function i(c,l,d,g,T=!1){const R=Math.ceil((r-c)/d),z=Math.ceil((e-l)/g),U=t*R,p=T?a:new Uint8Array(U*z);let B=0,P=0;for(;B<z&&s<o;){var k,C,n,D,w;switch(x[s++]){case 0:for(n=0;n<U;n++)p[P++]=x[s++];break;case 1:for(n=0;n<U;n++)k=x[s++],D=n<t?0:p[P-t],p[P++]=(k+D)%256;break;case 2:for(n=0;n<U;n++)k=x[s++],C=(n-n%t)/t,w=B&&p[(B-1)*U+C*t+n%t],p[P++]=(w+k)%256;break;case 3:for(n=0;n<U;n++)k=x[s++],C=(n-n%t)/t,D=n<t?0:p[P-t],w=B&&p[(B-1)*U+C*t+n%t],p[P++]=(k+Math.floor((D+w)/2))%256;break;case 4:for(n=0;n<U;n++){var I,A;k=x[s++],C=(n-n%t)/t,D=n<t?0:p[P-t],B===0?w=A=0:(w=p[(B-1)*U+C*t+n%t],A=C&&p[(B-1)*U+(C-1)*t+n%t]);const O=D+w-A,_=Math.abs(O-D),E=Math.abs(O-w),M=Math.abs(O-A);_<=E&&_<=M?I=D:E<=M?I=w:I=A,p[P++]=(k+I)%256}break;default:throw new Error(`Invalid filter algorithm: ${x[s-1]}`)}if(!T){let O=((l+B*g)*r+c)*t,_=B*U;for(n=0;n<R;n++){for(let E=0;E<t;E++)a[O++]=p[_++];O+=(d-1)*t}}B++}}return this.interlaceMethod===1?(i(0,0,8,8),i(4,0,8,8),i(0,4,4,8),i(2,0,4,4),i(0,2,2,4),i(1,0,2,2),i(0,1,1,2)):i(0,0,1,1,!0),a}decodePalette(){const{palette:x}=this,{length:r}=x,e=this.transparency.indexed||[],t=new Uint8Array((e.length||0)+r);let a=0,o=0;for(let i=0;i<r;i+=3){var s;t[a++]=x[i],t[a++]=x[i+1],t[a++]=x[i+2],t[a++]=(s=e[o++])!=null?s:255}return t}copyToImageData(x,r){let e,t,{colors:a}=this,o=null,s=this.hasAlphaChannel;this.palette.length&&(o=this._decodedPalette||(this._decodedPalette=this.decodePalette()),a=4,s=!0);const i=x.data||x,{length:c}=i,l=o||r;let d=e=0;if(a===1)for(;d<c;){t=o?r[d/4]*4:e;const g=l[t++];i[d++]=g,i[d++]=g,i[d++]=g,i[d++]=s?l[t++]:255,e=t}else for(;d<c;)t=o?r[d/4]*4:e,i[d++]=l[t++],i[d++]=l[t++],i[d++]=l[t++],i[d++]=s?l[t++]:255,e=t}decode(){const x=new Uint8Array(this.width*this.height*4);return this.copyToImageData(x,this.decodePixels()),x}decodeFrames(x){if(this.animation)for(let r=0;r<this.animation.frames.length;r++){const e=this.animation.frames[r],t=x.createImageData(e.width,e.height),a=this.decodePixels(new Uint8Array(e.data));this.copyToImageData(t,a),e.imageData=t,e.image=f(t)}}renderFrame(x,r){const{frames:e}=this.animation,t=e[r],a=e[r-1];return r===0&&x.clearRect(0,0,this.width,this.height),(a&&a.disposeOp)===b?x.clearRect(a.xOffset,a.yOffset,a.width,a.height):(a&&a.disposeOp)===S&&x.putImageData(a.imageData,a.xOffset,a.yOffset),t.blendOp===u&&x.clearRect(t.xOffset,t.yOffset,t.width,t.height),x.drawImage(t.image,t.xOffset,t.yOffset)}animate(x){let r=0;const{numFrames:e,frames:t,numPlays:a}=this.animation,o=()=>{const s=r++%e,i=t[s];this.renderFrame(x,s),e>1&&r/e<a&&(this.animation._timeout=setTimeout(o,i.delay))};o()}stopAnimation(){return clearTimeout(this.animation&&this.animation._timeout)}render(x){x._png&&x._png.stopAnimation(),x._png=this,x.width=this.width,x.height=this.height;const r=x.getContext("2d");if(this.animation)return this.decodeFrames(r),this.animate(r);{const e=r.createImageData(this.width,this.height);return this.copyToImageData(e,this.decodePixels()),r.putImageData(e,0,0)}}}return y}();function L(b){const S=$("#canvas");S.html("").width(b.width).height(b.height);const u=b.width*b.height,v=b.decodePixels(),m=Array(u*4);b.copyToImageData({data:m},v);let f=new Array(b.height),y=-1;for(let t=0;t<b.height;t++){const a=f[t]=new Array(b.width);for(let o=0;o<b.width;o++){y+=1;const s=m[4*y]||0,i=m[4*y+1]||0,c=m[4*y+2]||0;a[o]={next:{},w:1,h:1,x:o,y:t,r:s,g:i,b:c}}}let h=2,x=2;for(;x<=b.width;){const t=new Array(b.height/h);for(let a=0;a<b.height/h;a++){let o=t[a]=new Array(b.width/x);for(let s=0;s<b.width/x;s++){const i=f[2*a][2*s],c=f[2*a][2*s+1],l=f[2*a+1][2*s],d=f[2*a+1][2*s+1],g=parseInt((i.r+c.r+l.r+d.r)/4,10),T=parseInt((i.g+c.g+l.g+d.g)/4,10),R=parseInt((i.b+c.b+l.b+d.b)/4,10);o[s]={next:{tl:i,tr:c,bl:l,br:d},w:x,h,x:s*x,y:a*h,r:g,g:T,b:R}}}f=t,h*=2,x*=2}const r=t=>{let a=t.toString(16);return a.length<2?"0"+a:a},e=t=>{if(!t)return;const a=$("<p>"),o=`#${r(t.r)}${r(t.g)}${r(t.b)}`;a.css({left:t.x+"px",top:t.y+"px",width:t.w+"px",height:t.h+"px","background-color":o}).appendTo(S),t.next&&t.w>4&&a.mouseenter(()=>{a.remove(),e(t.next.tl),e(t.next.tr),e(t.next.bl),e(t.next.br)})};e(f[0][0])}const j="images/spaceman.png";PNG.load(j,null,L);
